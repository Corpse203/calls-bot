<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸ† Rainbet â€” Wager Race Top 10</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-gradient-to-br from-[#0f172a] via-[#020617] to-black text-white p-6">
  <div class="max-w-4xl mx-auto">

    <!-- Header -->
    <div class="text-center mb-10">
      <h1 class="text-4xl font-extrabold tracking-tight">ğŸ† PODIUM & TOP 10</h1>
      <p class="text-gray-400 mt-1">Classement officiel Rainbet</p>
      <p class="text-gray-500 mt-1 text-sm">
        ğŸ“… PÃ©riode : 07 dÃ©cembre 2025 â†’ 06 janvier 2026
      </p>
    </div>

    <!-- ğŸ† PODIUM -->
    <div id="podium" class="grid grid-cols-3 gap-4 items-end mb-12 text-center">
      <!-- 2e -->
      <div class="order-1">
        <div class="bg-white/10 rounded-xl p-4 h-40 flex flex-col justify-end">
          <div class="text-xl">ğŸ¥ˆ</div>
          <div id="p2-name" class="font-bold mt-1">â€”</div>
          <div id="p2-wager" class="text-sm text-gray-300">â€”</div>
        </div>
      </div>

      <!-- 1er -->
      <div class="order-2">
        <div class="bg-yellow-500/20 border border-yellow-400 rounded-xl p-4 h-52 flex flex-col justify-end shadow-lg shadow-yellow-500/20 animate-pulse">
          <div class="text-2xl">ğŸ¥‡</div>
          <div id="p1-name" class="font-extrabold text-lg mt-1">â€”</div>
          <div id="p1-wager" class="text-sm text-yellow-200">â€”</div>
        </div>
      </div>

      <!-- 3e -->
      <div class="order-3">
        <div class="bg-white/10 rounded-xl p-4 h-36 flex flex-col justify-end">
          <div class="text-xl">ğŸ¥‰</div>
          <div id="p3-name" class="font-bold mt-1">â€”</div>
          <div id="p3-wager" class="text-sm text-gray-300">â€”</div>
        </div>
      </div>
    </div>

    <!-- ğŸ“‹ TOP 10 TABLE -->
    <div class="bg-white/5 backdrop-blur-xl border border-white/10 rounded-2xl overflow-hidden shadow-2xl">
      <table class="w-full text-sm">
        <thead class="bg-white/10 text-gray-300">
          <tr>
            <th class="px-4 py-3 text-left">#</th>
            <th class="px-4 py-3 text-left">Joueur</th>
            <th class="px-4 py-3 text-right">Wager</th>
          </tr>
        </thead>
        <tbody id="tbody" class="divide-y divide-white/10"></tbody>
      </table>
    </div>

    <!-- Footer -->
    <div class="text-center text-xs text-gray-400 mt-4">
      DerniÃ¨re mise Ã  jour :
      <span id="updatedAt" class="font-semibold">â€”</span>
      <span class="mx-2">â€¢</span>
      RafraÃ®chissement dans
      <span id="countdown" class="font-semibold">60</span>s
    </div>

  </div>

<script>
  const tbody = document.getElementById("tbody");
  const updatedAt = document.getElementById("updatedAt");
  const countdownEl = document.getElementById("countdown");

  const p1n = document.getElementById("p1-name");
  const p1w = document.getElementById("p1-wager");
  const p2n = document.getElementById("p2-name");
  const p2w = document.getElementById("p2-wager");
  const p3n = document.getElementById("p3-name");
  const p3w = document.getElementById("p3-wager");

  // ğŸ“… PÃ‰RIODE FIXE
  const START_AT = "2025-12-07";
  const END_AT   = "2026-01-06";

  function format(n) {
    return Number(n).toLocaleString("fr-FR", {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    });
  }

  async function loadTop10() {
    try {
      const res = await fetch(
        `/api/rainbet/public-top?start_at=${START_AT}&end_at=${END_AT}`
      );
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || "Erreur API");

      const rows = data.top10;

      // ğŸ† Podium
      if (rows[0]) {
        p1n.textContent = rows[0].username;
        p1w.textContent = format(rows[0].wagered_amount);
      }
      if (rows[1]) {
        p2n.textContent = rows[1].username;
        p2w.textContent = format(rows[1].wagered_amount);
      }
      if (rows[2]) {
        p3n.textContent = rows[2].username;
        p3w.textContent = format(rows[2].wagered_amount);
      }

      // ğŸ“‹ Table Top 10
      tbody.innerHTML = "";
      rows.forEach((r) => {
        const tr = document.createElement("tr");
        tr.className = "hover:bg-white/5 transition";
        tr.innerHTML = `
          <td class="px-4 py-3 font-bold">${r.rank}</td>
          <td class="px-4 py-3 font-semibold">${r.username}</td>
          <td class="px-4 py-3 text-right tabular-nums">
            ${format(r.wagered_amount)}
          </td>
        `;
        tbody.appendChild(tr);
      });

      updatedAt.textContent = data.updated_at || "â€”";
    } catch (err) {
      console.error(err);
    }
  }

  // ğŸ” REFRESH AUTO
  let seconds = 60;
  countdownEl.textContent = seconds;

  setInterval(() => {
    seconds--;
    if (seconds <= 0) seconds = 60;
    countdownEl.textContent = seconds;
  }, 1000);

  loadTop10();
  setInterval(() => {
    seconds = 60;
    loadTop10();
  }, 60 * 1000);
</script>
</body>
</html>
