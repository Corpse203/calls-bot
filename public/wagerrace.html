<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸ† Rainbet â€” Top 10 Wager</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-gradient-to-br from-[#0f172a] via-[#020617] to-black text-white p-6">
  <div class="max-w-3xl mx-auto">

    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-4xl font-extrabold tracking-tight">ğŸ† TOP 10 WAGER</h1>
      <p class="text-gray-400 mt-1">Classement officiel Rainbet</p>
    </div>

    <!-- Card -->
    <div class="bg-white/5 backdrop-blur-xl border border-white/10 rounded-2xl overflow-hidden shadow-2xl">
      <table class="w-full text-sm">
        <thead class="bg-white/10 text-gray-300">
          <tr>
            <th class="px-4 py-3 text-left">#</th>
            <th class="px-4 py-3 text-left">Joueur</th>
            <th class="px-4 py-3 text-right">Wager</th>
          </tr>
        </thead>
        <tbody id="tbody" class="divide-y divide-white/10"></tbody>
      </table>
    </div>

    <!-- Footer -->
    <div class="text-center text-xs text-gray-400 mt-4">
      DerniÃ¨re mise Ã  jour :
      <span id="updatedAt" class="font-semibold">â€”</span>
      <span class="mx-2">â€¢</span>
      RafraÃ®chissement dans
      <span id="countdown" class="font-semibold">60</span>s
    </div>

  </div>

<script>
  const tbody = document.getElementById("tbody");
  const updatedAt = document.getElementById("updatedAt");
  const countdownEl = document.getElementById("countdown");

  function format(n) {
    return Number(n).toLocaleString("fr-FR", {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    });
  }

  async function loadTop10() {
    try {
      const now = new Date();
      const start = new Date(now);
      start.setDate(start.getDate() - 30);

      const s = start.toISOString().slice(0, 10);
      const e = now.toISOString().slice(0, 10);

      const res = await fetch(
        `/api/rainbet/public-top?start_at=${s}&end_at=${e}`
      );
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || "Erreur API");

      tbody.innerHTML = "";

      data.top10.forEach((r) => {
        const medal =
          r.rank === 1 ? "ğŸ¥‡" :
          r.rank === 2 ? "ğŸ¥ˆ" :
          r.rank === 3 ? "ğŸ¥‰" : r.rank;

        const tr = document.createElement("tr");
        tr.className = "hover:bg-white/5 transition";
        tr.innerHTML = `
          <td class="px-4 py-3 font-bold">${medal}</td>
          <td class="px-4 py-3 font-semibold">${r.username}</td>
          <td class="px-4 py-3 text-right tabular-nums">
            ${format(r.wagered_amount)}
          </td>
        `;
        tbody.appendChild(tr);
      });

      updatedAt.textContent = data.updated_at || "â€”";
    } catch (err) {
      tbody.innerHTML = `
        <tr>
          <td colspan="3" class="px-4 py-6 text-center text-red-400">
            âŒ Erreur de chargement
          </td>
        </tr>
      `;
    }
  }

  // -------- REFRESH AUTO --------
  let seconds = 60;
  countdownEl.textContent = seconds;

  setInterval(() => {
    seconds--;
    if (seconds <= 0) seconds = 60;
    countdownEl.textContent = seconds;
  }, 1000);

  loadTop10();
  setInterval(() => {
    seconds = 60;
    loadTop10();
  }, 60 * 1000);
</script>
</body>
</html>
